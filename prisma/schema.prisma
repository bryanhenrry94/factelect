generator client {
  provider = "prisma-client-js"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                   String                                             @id @default(uuid())
  name                 String                @map("name")
  tradeName            String?               @map("legal_name")
  subdomain            String                                             @unique
  ruc                  String?
  phone                String?               @map("phone")
  contactEmail         String?               @map("contact_email")
  address              String?               @map("address")
  logoUrl              String?               @map("logo_url")
  sriConfig            SRIConfiguration?
  obligatedAccounting  Boolean               @map("obligated_accounting") @default(false)

  createdAt            DateTime              @map("created_at")           @default(now())
  updatedAt            DateTime              @map("updated_at")           @updatedAt

  //                   Relaciones
  users                User[]
  documents            Document[]
  products             Product[]
  persons              Person[]

  transactions         Transaction[]
  transactionDocuments TransactionDocument[]
  bankAccounts         BankAccount[]
  bankMovements        BankMovement[]
  bankTransfers        BankTransfer[]
  cashBoxes            CashBox[]
  cashSessions         CashSession[]
  cashMovements        CashMovement[]
  cashCounts           CashCount[]
  cashReconciliations  CashReconciliation[]
  establishments       Establishment[]
  emissionPoints       EmissionPoint[]
  category             Category[]
  warehouse            Warehouse[]
  stock                Stock[]
  inventoryMovement    InventoryMovement[]
  warehouseTransfer    WarehouseTransfer[]
  units                Unit[]
  inventoryAdjustment  InventoryAdjustment[]

  @@map("tenant")
}

model SRIConfiguration {
  id                  String                                                                             @id @default(uuid())
  tenantId            String         @map("tenant_id")                                                   @unique
  environment         SRIEnvironment @map("sri_environment") // 1 Sandbox | 2 Producción                 @default("1")
  certificatePath     String?        @map("certificate_path") // Ruta o nombre del archivo subido (.p12)
  certificateUrl      String?        @map("certificate_url") // URL pública del archivo .p12
  certificatePassword String?        @map("certificate_password") // Password para el archivo .p12

  createdAt           DateTime       @map("created_at")                                                  @default(now())
  updatedAt           DateTime       @map("updated_at")                                                  @updatedAt

  //                  Relaciones
  tenant              Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("sri_configuration")
}

model Establishment {
  id                 String                                                    @id @default(cuid())
  tenantId           String               @map("tenant_id")
  tenant             Tenant               @relation(fields: [tenantId], references: [id])
  code               String               @map("code") // 3 dígitos, ej: '001'
  address            String               @map("address")
  documentFiscalInfo DocumentFiscalInfo[]
  emissionPoints     EmissionPoint[]

  @@map("establishment")
}

model EmissionPoint {
  id                 String                                                    @id @default(cuid())
  tenantId           String               @map("tenant_id")
  tenant             Tenant               @relation(fields: [tenantId], references: [id])
  establishmentId    String               @map("establishment_id")
  code               String               @map("code") // 3 dígitos, ej: '002'
  description        String?              @map("description")
  isActive           Boolean                                                   @default(true)
  establishment      Establishment        @relation(fields: [establishmentId], references: [id])
  documentFiscalInfo DocumentFiscalInfo[]

  @@map("emission_point")
}

model SequenceControl {
  id              String                                 @id @default(cuid())
  tenantId        String       @map("tenant_id")
  establishmentId String       @map("establishment_id")
  emissionPointId String       @map("emission_point_id")
  documentType    DocumentType
  currentSequence Int          @map("current_sequence")  @default(1)

  @@unique([tenantId, establishmentId, emissionPointId, documentType])
  @@map("sequence_control")
}

model User {
  id                  String               @map("id")         @id @default(cuid())
  email               String               @map("email")      @unique
  password            String               @map("password")
  name                String?              @map("name")
  role                UserRole             @map("role")       @default(USER)

  tenantId            String               @map("tenant_id")
  createdAt           DateTime             @map("created_at") @default(now())
  updatedAt           DateTime             @map("updated_at") @updatedAt
  tenant              Tenant               @relation(fields: [tenantId], references: [id])

  passwordResetTokens PasswordResetToken[]
  cashSessions        CashSession[]

  @@map("user")
}

model Product {
  id                      String                    @map("id")          @id @default(cuid())

  tenantId                String                    @map("tenant_id")
  tenant                  Tenant                    @relation(fields: [tenantId], references: [id])

  code                    String                    @map("code")
  description             String                    @map("description")
  price                   Float                     @map("price")
  tax                     TaxType                   @map("tax")         @default(IVA_0)
  type                    ProductType                                   @default(PRODUCT) // PRODUCT | SERVICE
  barcode                 String?                                       @unique
  cost                    Float                                         @default(0) // costo promedio o estándar

  unitId                  String
  unit                    Unit                      @relation(fields: [unitId], references: [id])

  categoryId              String                    @map("category_id")
  category                Category                  @relation(fields: [categoryId], references: [id])

  createdAt               DateTime                  @map("created_at")  @default(now())
  updatedAt               DateTime                  @map("updated_at")  @updatedAt

  documentItems           DocumentItem[]
  stocks                  Stock[]
  inventoryMovs           InventoryMovement[]
  warehouseTransferItem   WarehouseTransferItem[]
  InventoryAdjustmentItem InventoryAdjustmentItem[]

  @@unique([tenantId,     code])
  @@map("product")
}

model Unit {
  id       String                      @id @default(cuid())
  tenantId String    @map("tenant_id")
  name     String
  symbol   String

  tenant   Tenant    @relation(fields: [tenantId], references: [id])
  Product  Product[]

  @@map("unit")
}

model Category {
  id       String                      @id @default(cuid())
  tenantId String    @map("tenant_id")
  name     String

  products Product[]
  tenant   Tenant    @relation(fields: [tenantId], references: [id])

  @@map("category")
}

model Warehouse {
  id                      String                                      @id @default(cuid())
  tenantId                String                    @map("tenant_id")
  name                    String
  location                String?

  stocks                  Stock[]
  movements               InventoryMovement[]

  tenant                  Tenant                    @relation(fields: [tenantId], references: [id])
  documentItems           DocumentItem[]
  InventoryAdjustmentItem InventoryAdjustmentItem[]

  @@map("warehouse")
}

model Stock {
  id          String                         @id @default(cuid())
  tenantId    String    @map("tenant_id")
  productId   String    @map("product_id")
  warehouseId String    @map("warehouse_id")

  quantity    Float                          @default(0)
  minQuantity Float                          @default(0)

  product     Product   @relation(fields: [productId], references: [id])
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])

  tenant      Tenant    @relation(fields: [tenantId], references: [id])

  @@unique([productId, warehouseId])
  @@map("stock")
}

model InventoryMovement {
  id          String                                 @id @default(cuid())
  tenantId    String            @map("tenant_id")
  productId   String            @map("product_id")
  warehouseId String            @map("warehouse_id")
  documentId  String?           @map("document_id")
  type        InventoryMoveType @map("type")
  quantity    Float
  balance     Float                                  @default(0) // stock result after movement
  cost        Float                                  @default(0)
  totalCost   Float                                  @default(0)
  reference   String?
  date        DateTime                               @default(now())

  product     Product           @relation(fields: [productId], references: [id])
  warehouse   Warehouse         @relation(fields: [warehouseId], references: [id])
  document    Document?         @relation(fields: [documentId], references: [id])

  tenant      Tenant            @relation(fields: [tenantId], references: [id])

  @@index([productId])
  @@index([warehouseId])
  @@index([documentId])
  @@map("inventory_movement")
}

model InventoryAdjustment {
  id        String                     @id @default(cuid())
  tenantId  String
  date      DateTime                   @default(now())
  reason    String?
  createdBy String

  items     InventoryAdjustmentItem[]

  tenant    Tenant                    @relation(fields: [tenantId], references: [id])

  @@map("inventory_adjustment")
}

model InventoryAdjustmentItem {
  id                                                  String               @id @default(cuid())
  adjustmentId                                        String
  productId                                           String
  warehouseId                                         String
  quantity     Float // puede ser positiva o negativa
  cost                                                Float?

  adjustment                                          InventoryAdjustment @relation(fields: [adjustmentId], references: [id])
  product                                             Product             @relation(fields: [productId], references: [id])
  warehouse                                           Warehouse           @relation(fields: [warehouseId], references: [id])

  @@map("inventory_adjustment_item")
}

model WarehouseTransfer {
  id                                 String                                            @id @default(cuid())
  tenantId                           String                  @map("tenant_id")
  fromWarehouseId                    String                  @map("from_warehouse_id")
  toWarehouseId                      String                  @map("to_warehouse_id")
  date                               DateTime                                          @default(now())
  reference                          String?
  status                             TransferStatus                                    @default(PENDING)
  approvedBy      String? // usuario

  items                              WarehouseTransferItem[]

  tenant                             Tenant                  @relation(fields: [tenantId], references: [id])

  @@map("warehouse_transfer")
}

model WarehouseTransferItem {
  id         String                                @id @default(cuid())
  transferId String            @map("transfer_id")
  productId  String            @map("product_id")
  quantity   Float

  transfer   WarehouseTransfer @relation(fields: [transferId], references: [id])
  product    Product           @relation(fields: [productId], references: [id])

  @@map("warehouse_transfer_item")
}

model Document {
  id                  String                                                                            @id @default(cuid())
  tenantId            String                @map("tenant_id")
  entityType          EntityType                                                                        @default(CUSTOMER) // Cliente | Proveedor
  documentType        DocumentType
  number              String?
  issueDate           DateTime              @map("issue_date")                                          @default(now())
  dueDate             DateTime?             @map("due_date")                                            @default(now())
  status              DocumentStatus                                                                    @default(DRAFT) // draft | confirmed | canceled
  personId            String                @map("person_id") // Cliente (opcional si es venta abierta)

  //                  Totales
  subtotal            Float                                                                             @default(0)
  taxTotal            Float                 @map("tax_total")                                           @default(0)
  discount            Float                                                                             @default(0)
  total               Float                                                                             @default(0)
  paidAmount          Float                 @map("paid_amount")                                         @default(0)
  balance             Float                                                                             @default(0)

  description         String?               @map("description")

  //                  Auditoría
  createdAt           DateTime              @map("created_at")                                          @default(now())
  updatedAt           DateTime              @map("updated_at")                                          @updatedAt

  //                  Relaciones
  tenant              Tenant                @relation(fields: [tenantId], references: [id])
  person              Person                @relation(fields: [personId], references: [id])

  items               DocumentItem[]
  taxes               DocumentTax[]

  documentFiscalInfo  DocumentFiscalInfo?
  documentPayments    DocumentPayment[]
  inventoryMovement   InventoryMovement[]
  transactionDocument TransactionDocument[]

  @@unique([tenantId, number])
  @@index([tenantId])
  @@index([personId])
  @@map("document")
}

model DocumentItem {
  id             String                             @id @default(cuid())
  documentId     String     @map("document_id")
  document       Document   @relation(fields: [documentId], references: [id])

  productId      String     @map("product_id")
  product        Product    @relation(fields: [productId], references: [id])

  warehouseId    String?    @map("warehouse_id")
  warehouse      Warehouse? @relation(fields: [warehouseId], references: [id])

  quantity       Float                              @default(1)
  unitPrice      Float
  tax            TaxType                            @default(IVA_0)
  taxAmount      Float                              @default(0)
  discountRate   Float      @map("discount_rate")   @default(0)
  discountAmount Float      @map("discount_amount") @default(0)
  subtotal       Float
  total          Float

  @@map("document_item")
}

model DocumentTax {
  id              String                           @id @default(cuid())
  documentId      String   @map("document_id")
  code            String   @map("code")
  percentage_code String   @map("percentage_code")
  base            Float                            @default(0)
  amount          Float                            @default(0)

  document        Document @relation(fields: [documentId], references: [id])

  @@map("document_tax")
}

model DocumentFiscalInfo {
  id                String                                                             @id @default(cuid())

  documentId        String         @map("document_id")                                 @unique
  document          Document       @relation(fields: [documentId], references: [id])

  establishmentId   String         @map("establishment_id") // 001
  establishment     Establishment  @relation(fields: [establishmentId], references: [id])
  emissionPointId   String         @map("emission_point_id") // 002
  emissionPoint     EmissionPoint  @relation(fields: [emissionPointId], references: [id])
  sequence          Int

  accessKey         String?        @map("access_key") // Clave de acceso
  authorization     String?        @map("authorization") // Número de autorización
  authorizationDate DateTime?      @map("authorization_date") // Fecha de autorización

  sriStatus         SRIStatus      @map("sri_status")                                  @default(PENDING)
  environment       SRIEnvironment                                                     @default(TEST) // 1 pruebas, 2 producción

  generatedXmlUrl   String?        @map("generated_xml_url") // URL al XML firmado
  authorizedXmlUrl  String?        @map("authorized_xml_url") // URL XML autorizado
  pdfUrl            String?        @map("pdf_url") // URL del PDF RIDE

  @@map("document_fiscal_info")
}

model DocumentPayment {
  id            String   @map("id")                                        @id @default(uuid())

  documentId    String   @map("document_id")
  document      Document @relation(fields: [documentId], references: [id])

  paymentMethod String   @map("payment_method") // formaPago (códigos SRI)
  amount        Decimal  @map("amount") // total
  term          Int?     @map("term") // plazo
  termUnit      String?  @map("term_unit") // unidadTiempo: "dias"

  createdAt     DateTime @map("created_at")                                @default(now())

  @@map("document_payment")
}

model Retention {
  id         String                            @id @default(cuid())
  tenantId   String        @map("tenant_id")
  documentId String        @map("document_id")
  type       RetentionType
  percentage Float
  base       Float
  amount     Float

  @@map("retention")
}

model PasswordResetToken {
  id        String   @map("id")         @id @default(cuid())
  token     String   @map("token")      @unique
  userId    String   @map("user_id")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @map("created_at") @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_reset_token")
}

model Transaction {
  id                                                        String                                                                            @id @default(cuid())
  tenantId                                                  String                @map("tenant_id")

  personId                                                  String                @map("person_id")

  type   TransactionType // INCOME | EXPENSE
  method PaymentMethod // CASH, TRANSFER, CARD, CHECK, etc.

  amount                                                    Float
  issueDate                                                 DateTime              @map("issue_date")
  reference                                                 String?
  description                                               String?

  // Relación con Persona (cliente o proveedor)
  person                                                    Person                @relation(fields: [personId], references: [id])

  // Documentos pagados / cobrados
  documents                                                 TransactionDocument[]

  // Conciliación futura
  reconciled                                                Boolean                                                                           @default(false)
  reconciledAt                                              DateTime?             @map("reconciled_at")

  bankAccountId                                             String?               @map("bank_account_id") // cuenta bancaria usada (opcional)
  bankAccount                                               BankAccount?          @relation(fields: [bankAccountId], references: [id])

  cashBoxId                                                 String?               @map("cash_box_id") // caja usada (opcional)
  cashBox                                                   CashBox?              @relation(fields: [cashBoxId], references: [id])

  createdAt                                                 DateTime                                                                          @default(now())
  updatedAt                                                 DateTime                                                                          @updatedAt

  tenant                                                    Tenant                @relation(fields: [tenantId], references: [id])

  @@map("transaction")
}

model TransactionDocument {
  id                                            String                             @id @default(cuid())
  tenantId                                      String      @map("tenant_id")
  transactionId                                 String      @map("transaction_id")
  documentId                                    String      @map("document_id")

  amount Float // pago aplicado a ese documento

  document                                      Document    @relation(fields: [documentId], references: [id])
  transaction                                   Transaction @relation(fields: [transactionId], references: [id])

  createdAt                                     DateTime    @map("created_at")     @default(now())
  updatedAt                                     DateTime    @map("updated_at")     @updatedAt

  tenant                                        Tenant      @relation(fields: [tenantId], references: [id])

  @@map("transaction_document")
}

model BankAccount {
  id                                                               String                                @id @default(cuid())
  tenantId                                                         String         @map("tenant_id")
  bankName                                                         String         @map("bank_name")
  accountNumber                                                    String         @map("account_number")
  alias                                                            String?
  type          BankAccountType // CURRENT, SAVINGS, CREDIT, OTHER

  // NUEVO: referencia a la cuenta contable
  accountId                                                        String?
  account                                                          Account?       @relation(fields: [accountId], references: [id])

  createdAt                                                        DateTime       @map("created_at")     @default(now())
  updatedAt                                                        DateTime       @map("updated_at")     @updatedAt

  tenant                                                           Tenant         @relation(fields: [tenantId], references: [id])
  movements                                                        BankMovement[]
  transaction                                                      Transaction[]

  @@map("bank_account")
}

model BankMovement {
  id               String                                   @id @default(cuid())

  tenantId         String           @map("tenant_id")
  tenant           Tenant           @relation(fields: [tenantId], references: [id])

  bankAccountId    String           @map("bank_account_id")
  bankAccount      BankAccount      @relation(fields: [bankAccountId], references: [id])

  type             BankMovementType
  date             DateTime         @map("date")
  amount           Float
  reference        String?          @map("reference")
  description      String?

  accountId        String?
  account          Account?         @relation(fields: [accountId], references: [id])

  createdAt        DateTime         @map("created_at")      @default(now())

  bankTransfersOut BankTransfer[]   @relation("TransferOut")
  bankTransfersIn  BankTransfer[]   @relation("TransferIn")

  @@map("bank_movement")
}

model BankTransfer {
  id            String                                @id @default(uuid())
  tenantId      String        @map("tenant_id")

  fromAccountId String        @map("from_account_id")
  toAccountId   String        @map("to_account_id")

  amount        Decimal
  date          DateTime                              @default(now())
  description   String?
  reference     String?

  movementOutId String?
  movementInId  String?

  movementOut   BankMovement? @relation("TransferOut", fields: [movementOutId], references: [id], onDelete: Cascade)
  movementIn    BankMovement? @relation("TransferIn", fields: [movementInId], references: [id], onDelete: Cascade)

  createdAt     DateTime      @map("created_at")      @default(now())

  tenant        Tenant        @relation(fields: [tenantId], references: [id])

  @@map("bank_transfer")
}

model CashBox {
  id          String                           @id @default(cuid())
  name        String
  location    String
  createdAt   DateTime      @map("created_at") @default(now())
  updatedAt   DateTime      @map("updated_at") @updatedAt

  accountId   String?
  account     Account?      @relation(fields: [accountId], references: [id])

  tenantId    String        @map("tenant_id")
  tenant      Tenant        @relation(fields: [tenantId], references: [id])

  cashSession CashSession[]
  transaction Transaction[]

  @@map("cash_box")
}

model CashSession {
  id                 String                                      @id @default(cuid())
  tenantId           String               @map("tenant_id")
  cashBoxId          String               @map("cash_box_id")
  userId             String               @map("user_id")

  openedAt           DateTime             @map("opened_at")      @default(now())
  closedAt           DateTime?            @map("closed_at")
  initialAmount      Float                @map("initial_amount")
  closingAmount      Float?               @map("closing_amount")
  status             CashSessionStatus                           @default(OPEN)
  notes              String?              @map("notes")

  cashBox            CashBox              @relation(fields: [cashBoxId], references: [id])
  tenant             Tenant               @relation(fields: [tenantId], references: [id])
  user               User                 @relation(fields: [userId], references: [id])

  cashMovement       CashMovement[]
  cashCount          CashCount[]
  cashReconciliation CashReconciliation[]

  @@map("cash_session")
}

model CashMovement {
  id            String                                       @id @default(cuid())

  cashSessionId String               @map("cash_session_id")
  cashSession   CashSession          @relation(fields: [cashSessionId], references: [id])

  type          CashMovementType
  category      CashMovementCategory                         @default(OTHER)
  amount        Float
  description   String?
  reference     String?
  createdAt     DateTime             @map("created_at")      @default(now())

  accountId     String?
  account       Account?             @relation(fields: [accountId], references: [id])

  tenantId      String               @map("tenant_id")
  tenant        Tenant               @relation(fields: [tenantId], references: [id])

  @@map("cash_movement")
}

model CashCount {
  id            String                              @id @default(cuid())
  cashSessionId String      @map("cash_session_id")
  denomination  Float
  quantity      Int
  total         Float

  cashSession   CashSession @relation(fields: [cashSessionId], references: [id])

  tenantId      String      @map("tenant_id")
  tenant        Tenant      @relation(fields: [tenantId], references: [id])

  @@map("cash_count")
}

model CashReconciliation {
  id             String                              @id @default(cuid())
  tenantId       String      @map("tenant_id")
  cashSessionId  String      @map("cash_session_id")
  expectedAmount Float       @map("expected_amount")
  actualAmount   Float       @map("actual_amount")
  difference     Float

  cashSession    CashSession @relation(fields: [cashSessionId], references: [id])
  tenant         Tenant      @relation(fields: [tenantId], references: [id])

  @@map("cash_reconciliation")
}

model Person {
  id                  String                                               @id @default(cuid())
  personKind          PersonKind                                           @default(NATURAL)

  // Identificación primaria
  identificationType  IdentificationType     @map("identification_type")
  identification      String                 @map("identification")        @unique
  // Identificaciones secundarias
  identifications     PersonIdentification[]

  firstName           String?                @map("first_name")
  lastName            String?                @map("last_name")
  businessName        String?                @map("business_name")
  commercialName      String?                @map("commercial_name")
  email               String                 @map("email")
  phone               String?                @map("phone")
  address             String?                @map("address")
  roles               PersonRole[]                                         @default([])

  accountReceivableId String?                @map("account_receivable_id")
  accountPayableId    String?                @map("account_payable_id")

  accountReceivable   Account?               @relation("person_account_receivable", fields: [accountReceivableId], references: [id])
  accountPayable      Account?               @relation("person_account_payable", fields: [accountPayableId], references: [id])

  createdAt           DateTime               @map("created_at")            @default(now())
  updatedAt           DateTime               @map("updated_at")            @updatedAt

  tenantId            String                 @map("tenant_id")
  tenant              Tenant                 @relation(fields: [tenantId], references: [id])

  transactions        Transaction[]
  documents           Document[]
  ledgerEntries       LedgerEntry[]

  @@map("person")
}

model PersonIdentification {
  id                 String                                @id @default(cuid())
  personId           String             @map("person_id")
  person             Person             @relation(fields: [personId], references: [id])

  identificationType IdentificationType
  identification     String

  isPrimary          Boolean            @map("is_primary") @default(false)

  @@unique([identificationType, identification])
  @@map("person_identification")
}

// ------------------------------
// CATÁLOGO DE CUENTAS
// ------------------------------
model Account {
  id                String                                   @id @default(uuid())
  tenantId          String            @map("tenant_id")
  code              String
  name              String
  accountType       AccountType
  parentId          String?           @map("parent_id")
  parent            Account?          @relation("AccountHierarchy", fields: [parentId], references: [id])
  children          Account[]         @relation("AccountHierarchy")

  isAuxiliary       Boolean           @map("is_auxiliary")   @default(false)
  allowCustomer     Boolean           @map("allow_customer") @default(false)
  allowSupplier     Boolean           @map("allow_supplier") @default(false)

  ledgerEntries     LedgerEntry[]

  // NUEVOS → relaciones inversas necesarias
  personsReceivable Person[]          @relation("person_account_receivable")
  personsPayable    Person[]          @relation("person_account_payable")
  BankAccount       BankAccount[]
  BankMovement      BankMovement[]
  CashBox           CashBox[]
  CashMovement      CashMovement[]
  BankTransaction   BankTransaction[]

  @@map("account")
}

// ------------------------------
// COMPROBANTES CONTABLES
// ------------------------------
model JournalEntry {
  id           String                              @id @default(uuid())
  tenantId     String        @map("tenant_id")
  entryNumber  Int           @map("entry_number")
  date         DateTime
  description  String?
  type         EntryType                           @default(JOURNAL)
  documentType DocumentType? @map("document_type")
  documentId   String?       @map("document_id")

  // Relación con líneas
  entries      LedgerEntry[]

  createdAt    DateTime      @map("created_at")    @default(now())
  updatedAt    DateTime      @map("updated_at")    @updatedAt

  @@map("journal_entry")
}

// ------------------------------
// LÍNEAS DEL ASIENTO CONTABLE
// ------------------------------
model LedgerEntry {
  id             String                                @id @default(uuid())
  tenantId       String       @map("tenant_id")
  journalEntryId String       @map("journal_entry_id")
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id])

  accountId      String       @map("account_id")
  account        Account      @relation(fields: [accountId], references: [id])

  debit          Decimal                               @default(0.00)
  credit         Decimal                               @default(0.00)

  personId       String?      @map("person_id")
  person         Person?      @relation(fields: [personId], references: [id])

  costCenterId   String?      @map("cost_center_id")
  createdAt      DateTime     @map("created_at")       @default(now())
  CostCenter     CostCenter?  @relation(fields: [costCenterId], references: [id])

  @@map("ledger_entry")
}

// ------------------------------
// CENTROS DE COSTO
// ------------------------------
model CostCenter {
  id            String                          @id @default(uuid())
  tenantId      String        @map("tenant_id")
  code          String
  name          String

  ledgerEntries LedgerEntry[]

  @@unique([tenantId, code])
  @@map("cost_center")
}

// ------------------------------
// IMPUESTOS (IVA, retenciones, etc.)
// ------------------------------
model Tax {
  id       String                    @id @default(uuid())
  tenantId String  @map("tenant_id")
  name     String
  rate     Decimal

  @@map("tax")
}

// ------------------------------
// MOVIMIENTOS DE CUENTAS BANCARIAS (para conciliación)
// ------------------------------
model BankTransaction {
  id          String                      @id @default(uuid())
  tenantId    String   @map("tenant_id")
  date        DateTime
  description String?
  amount      Decimal
  reference   String?
  accountId   String   @map("account_id")
  account     Account  @relation(fields: [accountId], references: [id])
  matched     Boolean                     @default(false)

  @@map("bank_transaction")
}

enum UserRole {
  ADMIN
  USER
}

enum IdentificationType {
  RUC
  CEDULA
  PASAPORTE
  VENTA_A_CONSUMIDOR_FINAL
  IDENTIFICACION_DE_EXTERIOR
  PLACA
}

enum TaxType {
  IVA_0
  IVA_5
  IVA_12
  IVA_14
  IVA_15
  NO_IVA
  EXENTO_IVA
}

enum TransactionType {
  INCOME // Cobro
  EXPENSE // Pago
}

enum PaymentMethod {
  CASH // Caja
  TRANSFER // Transferencia
  PETTY_CASH // Caja chica (solo para pagos)
  CREDIT_CARD // Tarjeta crédito (solo para pagos)
}

enum DocumentStatus {
  DRAFT
  CONFIRMED
  CANCELED
}

enum PersonRole {
  CLIENT
  SUPPLIER
  SELLER
}

enum EntityType {
  CUSTOMER
  SUPPLIER
}

enum SRIStatus {
  PENDING // Lista para enviar
  SENT // XML enviado
  AUTHORIZED // Autorizada
  REJECTED // Rechazada por SRI
}

enum SRIEnvironment {
  TEST
  PRODUCTION
}

enum AccountKind {
  BANK
  CASH
  CARD
  WALLET
}

enum BankMovementType {
  DEPOSIT
  WITHDRAWAL
  TRANSFER_IN
  TRANSFER_OUT
  FEE
}

enum CashMovementType {
  IN
  OUT
}

enum TransferStatus {
  PENDING
  APPROVED
  CANCELED
}

enum InventoryMoveType {
  IN
  OUT
  TRANSFER_OUT
  TRANSFER_IN
  ADJUST
}

enum ProductType {
  PRODUCT
  SERVICE
}

// ------------------------------
// ENUMS
// ------------------------------
enum AccountType {
  ASSET // Activos
  LIABILITY // Pasivos
  EQUITY // Patrimonio
  INCOME // Ingresos
  EXPENSE // Gastos
}

enum EntryType {
  JOURNAL // Diario general
  ADJUSTMENT // Ajuste
  CLOSING // Cierre contable
}

enum DocumentType {
  INVOICE // Factura
  BILL // Gasto / Cuenta por pagar
  RECEIPT // Recibo
  PAYMENT // Pago
  COLLECTION // Cobro
  OTHER
}

enum BankAccountType {
  CURRENT
  SAVINGS
  CREDIT
  OTHER
}

enum RetentionType {
  IVA
  RENTA
}

enum PersonKind {
  NATURAL
  LEGAL
}

enum CashSessionStatus {
  OPEN
  CLOSED
  PENDING
}

enum CashMovementCategory {
  SALE
  PURCHASE
  PETTY_CASH
  ADVANCE
  REFUND
  TRANSFER
  OTHER
}